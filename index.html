<!doctype html>
<html lang="es">
<head>
<link rel="manifest" href="./manifest.webmanifest">
<meta name="theme-color" content="#ff2d55">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Falleando by Chema Valero</title>

  <!-- Leaflet -->
<link rel="stylesheet" href="./style.css?v=20260220-1">
<script defer src="./app.js?v=20260220-1"></script>

  <style>
    html, body { height: 100%; margin: 0; }
    #map { height: 100%; width: 100%; }

    .topbar{
      position: fixed; z-index: 9999; left: 12px; top: 12px;
      background: rgba(255,255,255,0.95); border-radius: 12px;
      padding: 10px 12px; box-shadow: 0 8px 30px rgba(0,0,0,0.15);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      max-width: 420px;
      min-width: 250px;
      backdrop-filter: blur(6px);
    }
    .topbar strong { display:block; margin-bottom: 6px; }
    .row { display:flex; gap:8px; margin-top: 6px; }
    select, input, button {
      width: 100%;
      padding: 8px;
      border-radius: 10px;
      border: 1px solid #ddd;
      background: #fff;
      box-sizing: border-box;
      font-family: inherit;
    }
    .hint { font-size: 12px; opacity: 0.7; margin-top: 6px; }

    /* Multi-secciones */
    .section-multi { position: relative; width: 100%; margin-top:6px; }
    .sections-toggle{
      width: 100%;
      padding: 8px;
      border-radius: 10px;
      border: 1px solid #ddd;
      background: #fff;
      cursor: pointer;
      text-align: left;
      font-weight: 600;
    }
    .sections-panel{
      position: absolute;
      top: 44px;
      left: 0;
      width: 100%;
      max-height: 260px;
      overflow: auto;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,.15);
      padding: 10px;
      z-index: 10001;
    }
    .sec-item{
      display:flex;
      align-items:center;
      gap:8px;
      padding:6px 4px;
      border-radius: 8px;
    }
    .sec-item:hover { background: rgba(0,0,0,.04); }
    .hidden { display: none; }

    /* Bot√≥n flotante */
    .fab {
      position: fixed;
      bottom: 18px;
      right: 18px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: none;
      background: #ff2d55;
      color: white;
      font-size: 26px;
      box-shadow: 0 6px 18px rgba(0,0,0,.25);
      cursor: pointer;
      z-index: 10000;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    /* Panel */
    .route-panel {
      position: fixed;
      bottom: 90px;
      right: 18px;
      width: 280px;
      background: white;
      border-radius: 16px;
      padding: 14px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      z-index: 10000;
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    .panel-title { font-weight: 800; font-size: 14px; }
    .panel-buttons { display:flex; gap: 6px; }
    .panel-buttons button {
      flex: 1;
      padding: 8px;
      border-radius: 10px;
      border: 1px solid #ddd;
      background: #fff;
      cursor: pointer;
      font-weight: 600;
    }
    .panel-buttons button.primary {
      background: #111;
      color: #fff;
      border-color: #111;
    }

    /* Marker base */
    .falla-marker {
      position: relative;
      width: 34px;
      height: 34px;
      border-radius: 50%;
      border: 3px solid white;
      box-shadow: 0 3px 10px rgba(0,0,0,.35);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:800;
      font-size:12px;
      color:white;
    }
    .falla-visited {
      background:#888 !important;
      filter: grayscale(0.7);
      opacity:.7;
    }

    /* Escala 9 colores (dorado-naranja ‚Üí morado) */
    .sec-E  { background:#f97316; }              
    .sec-1A, .sec-1B { background:#f4a300; }    
    .sec-2A, .sec-2B { background:#facc15; color:#000; }
    .sec-3A, .sec-3B, .sec-3C { background:#e4466f; } 
    .sec-4A, .sec-4B, .sec-4C { background:#ce41a1; }
    .sec-5A, .sec-5B, .sec-5C { background:#c32dc8; }
    .sec-6A, .sec-6B, .sec-6C { background:#905eed; }
    .sec-7A, .sec-7B, .sec-7C { background:#a855f7; }   /* violeta */
    .sec-8A, .sec-8B, .sec-8C { background:#6b21a8; } 
    .sec-FC { background:#555; }  /* morado oscuro */
.panel-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.panel-close{
  width:auto;
  padding:6px 10px;
  border-radius:10px;
  border:1px solid #ddd;
  background:#fff;
  cursor:pointer;
  font-weight:800;
  line-height:1;
}

.sections-panel { text-align: left; }

.sec-item{
  display:flex;
  align-items:center;
  justify-content:flex-start !important;
  gap:10px;
  width:100%;
}

.sec-item input{
  flex: 0 0 auto;
  margin: 0;
}

.sec-item span, .sec-item strong{
  flex: 0 0 auto;
  margin: 0;
}

.sections-panel{
  max-height: 220px; /* antes 260 */
}

/* FIX: No aplicar width:100% a checkboxes/radios */
input[type="checkbox"],
input[type="radio"]{
  width: auto !important;
}

/* Alinear items del panel de secciones */
.sections-panel { text-align: left; }

.sec-item{
  display:flex !important;
  align-items:center !important;
  justify-content:flex-start !important;
  gap:10px !important;
  width:100% !important;
}

.sec-item span, .sec-item strong{
  margin:0 !important;
}

.hidden { display: none; }


.topbar-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
}

.topbar-toggle{
  border:1px solid #ddd;
  background:#fff;
  border-radius:10px;
  width:32px;
  height:32px;
  cursor:pointer;
  font-weight:900;
  font-size:14px;
}

/* Estado colapsado */
.topbar.collapsed #topbarContent{
  display:none;
}

.topbar.collapsed{
  padding:8px 12px;
}

.topbar.collapsed strong{
  font-size:14px;
}

.leaflet-control-zoom.leaflet-bar.leaflet-control {
    margin-top: 70px;
}

/* Chemas CSS */

.popuptitle {
    text-transform: uppercase;
    font-weight: 200;
    font-size: 16px;
    line-height: 1.2;
    color: #000;
}

.seccion {
    margin-top: 4px !important;
    font-size: 14px !important;
    color: #555;
}

.seccion strong {
    color: #000;
    font-weight: 600;
    margin-bottom: 2px;
}

.leaflet-popup-content img {
    width: 100%;
    border-radius:5px !important;
    margin-top:10px;
    border:1px solid #eee;
}

.leaflet-popup-content {
    width: 200px !important;
}

.valorargrande, .valorarinfantil {
    width: 50%;
    display: initial !important;
}

.valorargrande label, .valorarinfantil label {
    display: initial !important;
}

.valorargrande span, .valorargrande input, .valorarinfantil span, .valorarinfantil input {
    width: 100%;

}

.visited {
 width: 48%;
  margin-right: 2%;
}
  .visited input {
    display: none;
}

.visited span{
  display:flex;
  color: #000;
  align-items:center;
  gap:8px;
  padding:6px 10px;
  border-radius:4px;
  cursor:pointer;
  transition:.2s;
  border:1px solid transparent;
  background: #ccc;
  width: 100%;
}

.visited:hover span {
    background: #aaa;
}

.visited input:checked + span{

  background:rgb(178 105 255);
}

.visited input:checked + span::before{
  content:"‚úì ";
  color:#fff;
}

.visited input:checked + span{
  color:#fff;
}

.wishlist {
 width: 48%;
}
  .wishlist input {
    display: none;
}

.wishlist span{
  display:flex;
  color: #000;
  align-items:center;
  gap:8px;
  padding:6px 10px;
  border-radius:4px;
  cursor:pointer;
  transition:.2s;
  border:1px solid transparent;
  background: #ccc;
  width: 100%;
}

.wishlist:hover span {
    background: #aaa;
}

.wishlist input:checked + span{

  background:rgb(178 105 255);
}

.wishlist input:checked + span{
  color:#fff;
}

checks-row{
  display:flex;
  gap:10px;
  margin-top:8px;
}

.checks-row .visited, .checks-row .wishlist{
  flex:1;
  justify-content:center;
  text-align:center;
}

/* Chemas CSS Ends*/

  </style>
</head>

<body>
<div id="topbar" class="topbar expanded">
  <div class="topbar-header">
    <strong>Falleando</strong>
       <button id="topbarToggle" class="topbar-toggle" aria-label="Contraer">‚ñæ</button>
  </div>
  <div id="topbarContent">
    <!-- Multi-secciones con checkboxes -->
    <div class="section-multi">
      <button id="sectionsToggleBtn" class="sections-toggle">Secciones (todas)</button>

        <div id="sectionsPanel" class="sections-panel hidden">
          <label class="sec-item">
            <input type="checkbox" id="sec_all" checked />
            <strong>Todas</strong>
          </label>
          <div id="sectionsList"></div>
       </div>
    </div>

    <div class="row">
      <input id="textFilter" placeholder="Buscar (Na Jordana, 9‚Ä¶)" />
    </div>

    <div class="row">
      <select id="statusFilter">
  <option value="ALL">Todas</option>
  <option value="VISITED">Visitadas</option>
  <option value="NOT_VISITED">No visitadas</option>
  <option value="WISH">Quiero ver</option>
</select>
    </div>

    <div id="appVersion" style="font-size:12px;opacity:.7"></div><div class="hint">App creada por <a href="http://instagram.com/chemaart/" target="_blank">Chema Valero</a></div>
  </div>
</div>
  <div id="map"></div>

  <!-- Bot√≥n flotante -->
  <button id="routeToggleBtn" class="fab" title="Opciones de ruta">üß≠</button>

  <!-- Panel de ruta -->
  <div id="routePanel" class="route-panel hidden">
    <div class="panel-header">
  <div class="panel-title">Ruta</div>
  <button id="routeCloseBtn" class="panel-close" aria-label="Cerrar">‚úï</button>
</div>


    <label for="timeMin">Tiempo disponible (min)</label>
    <input id="timeMin" type="number" min="1" max="600" value="45" />

    <label for="speedKmh">Velocidad (km/h)</label>
    <input id="speedKmh" type="number" min="2" max="10" step="0.1" value="4.5" />

    <label style="display:flex;align-items:center;gap:8px;margin-top:6px;">
      <input type="checkbox" id="ignoreVisitedChk" checked />
      Ignorar fallas visitadas
    </label>

    <div class="panel-buttons" style="margin-top:6px;">
      <button id="locateBtn">üìç Mi ubicaci√≥n</button>
      <button id="pickStartBtn">üéØ Elegir inicio</button>
    </div>

    <div class="panel-buttons">
      <button id="routeBtn" class="primary">Crear ruta</button>
      <button id="clearRouteBtn">Borrar</button>
    </div>
  </div>

  <script src="./app.js?v=8" defer></script>
  
  <script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("./service-worker.js");
  }
</script>
</body>
</html>
